{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Homol/rag-resends/app/api/chat/route.js"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport { GoogleGenerativeAI } from \"@google/generative-ai\";\r\nimport { getIndex } from \"@/pinecone/client\";\r\n\r\nif (!process.env.GOOGLE_API_KEY) {\r\n  throw new Error(\"Missing GOOGLE_API_KEY\");\r\n}\r\n\r\nconst genAI = new GoogleGenerativeAI(process.env.GOOGLE_API_KEY);\r\nconst chatModel = genAI.getGenerativeModel({ model: \"gemini-2.5-flash\" });\r\nconst embeddingModel = genAI.getGenerativeModel({\r\n  model: \"text-embedding-004\",\r\n});\r\n\r\nexport async function POST(req) {\r\n  try {\r\n    const { question } = await req.json();\r\n    if (!question) {\r\n      return NextResponse.json({ error: \"Question required\" }, { status: 400 });\r\n    }\r\n\r\n    // 1️⃣ Embed user question\r\n    const embedRes = await embeddingModel.embedContent(question);\r\n    const vector = embedRes.embedding.values;\r\n\r\n    // 2️⃣ Search Pinecone\r\n    const index = getIndex();\r\n    const search = await index.query({\r\n      vector,\r\n      topK: 5,\r\n      includeMetadata: true,\r\n    });\r\n\r\n    const context = search.matches\r\n      .map((m, i) => `Source ${i + 1}:\\n${m.metadata.qa}`)\r\n      .join(\"\\n\\n\");\r\n\r\n    // 3️⃣ Ask Gemini with context\r\n    const prompt = `\r\nYou are a helpful documentation chatbot.\r\nIf the question is not related to Resend or the context,\r\nrespond exactly with:\r\n\"I can only answer questions related to the Resend website.\"\r\n\r\nCONTEXT:\r\n${context}\r\n\r\nQUESTION:\r\n${question}\r\n`;\r\n\r\n    const res = await chatModel.generateContent(prompt);\r\n\r\n    return NextResponse.json({\r\n      answer: res.response.text(),\r\n    });\r\n  } catch (err) {\r\n    console.error(err);\r\n    return NextResponse.json(\r\n      { error: \"Something went wrong\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;;;;;;;AAGA,IAAI,CAAC,QAAQ,GAAG,CAAC,cAAc,EAAE;IAC/B,MAAM,IAAI,MAAM;AAClB;AAEA,MAAM,QAAQ,IAAI,sLAAkB,CAAC,QAAQ,GAAG,CAAC,cAAc;AAC/D,MAAM,YAAY,MAAM,kBAAkB,CAAC;IAAE,OAAO;AAAmB;AACvE,MAAM,iBAAiB,MAAM,kBAAkB,CAAC;IAC9C,OAAO;AACT;AAEO,eAAe,KAAK,GAAG;IAC5B,IAAI;QACF,MAAM,EAAE,QAAQ,EAAE,GAAG,MAAM,IAAI,IAAI;QACnC,IAAI,CAAC,UAAU;YACb,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAoB,GAAG;gBAAE,QAAQ;YAAI;QACzE;QAEA,0BAA0B;QAC1B,MAAM,WAAW,MAAM,eAAe,YAAY,CAAC;QACnD,MAAM,SAAS,SAAS,SAAS,CAAC,MAAM;QAExC,sBAAsB;QACtB,MAAM,QAAQ;QACd,MAAM,SAAS,MAAM,MAAM,KAAK,CAAC;YAC/B;YACA,MAAM;YACN,iBAAiB;QACnB;QAEA,MAAM,UAAU,OAAO,OAAO,CAC3B,GAAG,CAAC,CAAC,GAAG,IAAM,CAAC,OAAO,EAAE,IAAI,EAAE,GAAG,EAAE,EAAE,QAAQ,CAAC,EAAE,EAAE,EAClD,IAAI,CAAC;QAER,8BAA8B;QAC9B,MAAM,SAAS,CAAC;;;;;;;AAOpB,EAAE,QAAQ;;;AAGV,EAAE,SAAS;AACX,CAAC;QAEG,MAAM,MAAM,MAAM,UAAU,eAAe,CAAC;QAE5C,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,QAAQ,IAAI,QAAQ,CAAC,IAAI;QAC3B;IACF,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC;QACd,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAuB,GAChC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}